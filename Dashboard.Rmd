---
title: "Instacart Dashboard"
output:
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    theme: cerulean
---

```{r setup, include=FALSE}
library(tidyverse)
library(plotly)
library(flexdashboard)
library(p8105.datasets)

data("instacart")
set.seed(123)

# Set sampling size
instacart_samp <- instacart |> sample_n(5000)
```

Column {data-width=550}
-----------------------------------------------------------------------

### Scatter Plot: Hour vs Add-to-Cart (Interactive scatter plot)

```{r}
p_scatter <- instacart_samp |>
  plot_ly(
    x = ~order_hour_of_day,
    y = ~add_to_cart_order,
    type = "scatter",
    mode = "markers",
    color = ~reordered,
    colors = c("#00AFBB", "#E7B800"),
    alpha = 0.5,
    text = ~ paste(
      "Product:", product_name,
      "<br>Order ID:", order_id
    )
  ) |>
  layout(
    title = "Relationship between shopping hour and add-to-cart order",
    xaxis = list(title = "Hour of day"),
    yaxis = list(title = "Add-to-cart order")
  )

p_scatter
```

Column {data-width=450}
-----------------------------------------------------------------------

### Box Plot: Distribution of Add-to-Cart Order by Department

```{r}
p_box <- instacart_samp |>
  mutate(department = fct_lump(department, 10)) |>
  plot_ly(
    y = ~add_to_cart_order,
    color = ~department,
    type = "box",
    colors = "Set3"
  ) |>
  layout(
    title = "Add-to-cart order by department",
    yaxis = list(title = "Add-to-cart order")
  )

p_box
```

### Bar Chart: Most Frequent Aisles Ordered From

```{r}
p_bar <- instacart_samp |>
  count(aisle, sort = TRUE) |>
  slice_max(n, n = 15) |>
  plot_ly(
    x = ~reorder(aisle, n),
    y = ~n,
    type = "bar",
    color = ~aisle,
    colors = "Blues"
  ) |>
  layout(
    title = "Top 15 Aisles by Order Count",
    xaxis = list(
      title = "Aisle",
      tickangle = -45,     
      tickfont = list(size = 10) 
    ),
    yaxis = list(title = "Number of Orders"),
    margin = list(b = 120) 
  )

p_bar
```